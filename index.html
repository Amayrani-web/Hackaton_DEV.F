<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>GRUPO SID by Traxi贸n - Mantenimiento de Unidades</title>
    <link rel="stylesheet" href="styles.css" />
</head>
    <style>
        /* Estilos r谩pidos para el chat */
        #chat-toggle { position: fixed; bottom: 20px; right: 20px; background: #444; color: white; border: none; border-radius: 50%; width: 60px; height: 60px; cursor: pointer; font-size: 24px; z-index: 1001; }
        .chat-window { position: fixed; bottom: 90px; right: 20px; width: 320px; height: 450px; background: white; border: 1px solid #ccc; border-radius: 12px; display: none; flex-direction: column; box-shadow: 0 5px 20px rgba(0,0,0,0.2); z-index: 1000; font-family: sans-serif; }
        .chat-header { background: #666; color: white; padding: 15px; border-radius: 12px 12px 0 0; font-weight: bold; }
        .chat-box { flex: 1; overflow-y: auto; padding: 15px; background: #f9f9f9; }
        .chat-input-area { display: flex; padding: 10px; gap: 5px; border-top: 1px solid #eee; }
        .chat-input-area input { flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 5px; }
        .chat-input-area button { background: #444; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; }
        .msg-user { background: #e3f2fd; padding: 8px; border-radius: 8px; margin-bottom: 10px; text-align: right; }
        .msg-ai { background: #eee; padding: 8px; border-radius: 8px; margin-bottom: 10px; }
    </style>
<body>
    <div class="imagen-centrada">
        <img src="https://traxion.global/hubfs/traxion-global-sitio-mar24/Nuevos%20Logos%20REDIMENSI%C3%93N/Logos%20TRAXION%20-%20No%20tilde/SVG-500x150_17-TRAXION%20ESP%20GRIS.svg" alt="Logo Traxi贸n" width="250" height="75">
    </div>
    <div class="color-y-fondo">Cuidar nuestras unidades es parte de nuestro trabajo.</div>
    <div class="seccion-imagen-fondo">
        <p>Cada colaborador es responsable de reportar, revisar y mantener en buen estado la unidad asignada.</p>
    </div>

    <section class="apply-section-textarea"> 
        <form id="apply">   
            <label>Fecha de Inspecci贸n: <input type="date" name="fecha" required></label><br>
            <label>Nombre Completo: <input name="name" required> </label><br>
            <label>Numero de Unidad o equipo de arrastre: <input name="unidad"></label><br>
            <label>Base original de Trabajo: <input name="base"></label><br>    
            <label>Ubicaci贸n actual de la unidad.: <input name="position"></label><br>
            <p>Tipo de Mantenimiento:</p>
            <label><select id="tipoMantenimiento" name="tipoMantenimiento" required>
                <option value="">-- Selecciona una opci贸n --</option>
                <option value="Preventivo">Preventivo</option>
                <option value="Correctivo">Correctivo</option>
                <option value="Emergente">Emergente</option>
            </select></label><br>
            <div id="estadoUnidadDiv" style="display: none;">
                <p>Estado de la Unidad:</p>
                <label><select name="estadoUnidad">
                    <option value="">-- Selecciona una opci贸n --</option>
                    <option value="La unidad puede operar">La unidad puede operar</option>
                    <option value="Operar con restricciones">Operar con restricciones</option>
                    <option value="No puede operar">No puede operar</option>
                </select></label><br>
            </div>
            <div id="estadoEntregaDiv" style="display: none;">
                <p>Estado de Entrega:</p>
                <label><select name="estadoEntrega">
                    <option value="">-- Selecciona una opci贸n --</option>
                    <option value="Estaba por entregar">Estaba por entregar</option>
                    <option value="Tenia entrega lista">Tenia entrega lista</option>
                </select></label><br>
            </div>
            <label>Subir Evidencia: <input type="file" name="evidencia" id="evidencia" accept=".jpg, .png, .pdf" multiple> </label><br>
            <label>Descripci贸n detallada de la falla:<br><textarea name="comment"></textarea></label><br> 
            <button type="submit" class="button-submit">Enviar</button>
        </form>
        <div id="msg" aria-live="polite"></div>
    </section>

    <button id="chat-toggle" onclick="toggleChat()"></button>
    <div id="chat-container" class="chat-window">
        <div class="chat-header">Asistente Traxi贸n (Prototipo)</div>
        <div id="chat-box" class="chat-box">
            <div class="msg-ai">Hola, soy el asistente t茅cnico. Escribe un c贸digo SPN (ej. 1761) o una duda (ej. urea, llantas) para ayudarte.</div>
        </div>
        <div class="chat-input-area">
            <input type="text" id="user-input" placeholder="Escribe tu duda...">
            <button onclick="enviarMensaje()">Enviar</button>
        </div>
    </div>

    <script>
        // L贸gica de visibilidad de campos
        document.getElementById('tipoMantenimiento').addEventListener('change', function() {
            document.getElementById('estadoUnidadDiv').style.display = (this.value === 'Emergente') ? 'block' : 'none';
            document.getElementById('estadoEntregaDiv').style.display = (this.value === 'Correctivo' || this.value === 'Emergente') ? 'block' : 'none';
        });

        // L贸gica del Chatbot Prototipo (Sin API)
        const chatContainer = document.getElementById('chat-container');
        const chatBox = document.getElementById('chat-box');
        const userInput = document.getElementById('user-input');

        // Base de conocimientos local para el prototipo
        const respuestasPrototipo = {
            "1761": "<b>SPN 1761:</b> Nivel de Urea (DEF). Mantener >25% para evitar cristalizaci贸n.",
            "3251": "<b>SPN 3251:</b> Saturaci贸n DPF. Se recomienda programar regeneraci贸n al llegar al 60%.",
            "102": "<b>SPN 102:</b> Presi贸n de Turbo. Reportar silbidos de inmediato para evitar da帽os mayores.",
            "urea": "Recuerda que si el nivel de urea baja del 10%, la unidad perder谩 potencia autom谩ticamente.",
            "llantas": "Revisar que el dibujo sea > 3mm y que no haya objetos atrapados en el eje dual.",
            "aceite": "Verificar nivel con motor fr铆o. No sobrepasar el m谩ximo para evitar da帽os en sellos.",
            "frenos": "No mover la unidad si el man贸metro de aire indica menos de 90 PSI."
        };

        function toggleChat() {
            chatContainer.style.display = (chatContainer.style.display === 'none' || chatContainer.style.display === '') ? 'flex' : 'none';
        }

        function enviarMensaje() {
            const texto = userInput.value.trim().toLowerCase();
            if (!texto) return;

            // Mostrar mensaje del usuario
            chatBox.innerHTML += `<div class="msg-user"><b>T煤:</b> ${userInput.value}</div>`;
            userInput.value = '';
            chatBox.scrollTop = chatBox.scrollHeight;

            // Buscar respuesta local
            let respuestaIA = "Lo siento, soy un prototipo y a煤n no reconozco esa duda. Prueba con: 1761, urea o llantas.";
            
            for (let clave in respuestasPrototipo) {
                if (texto.includes(clave)) {
                    respuestaIA = respuestasPrototipo[clave];
                    break;
                }
            }

            // Simular respuesta despu茅s de 500ms
            setTimeout(() => {
                chatBox.innerHTML += `<div class="msg-ai"><b>Asistente:</b> ${respuestaIA}</div>`;
                chatBox.scrollTop = chatBox.scrollHeight;
            }, 500);
        }

        userInput.addEventListener("keypress", (e) => { if (e.key === "Enter") enviarMensaje(); });
    </script>
</body>
</html>