<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>GRUPO SID by Traxión - Mantenimiento de Unidades</title>
    <link rel="stylesheet" href="styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="imagen-centrada">
        <img src="https://traxion.global/hubfs/traxion-global-sitio-mar24/Nuevos%20Logos%20REDIMENSI%C3%93N/Logos%20TRAXION%20-%20No%20tilde/SVG-500x150_17-TRAXION%20ESP%20GRIS.svg" alt="Logo Traxión" width="250" height="75">
    </div>
    <div class="color-y-fondo">Cuidar nuestras unidades es parte de nuestro trabajo.</div>
    <h1></h1>
    <div class="seccion-imagen-fondo">
        <p>Cada colaborador es responsable de reportar, revisar y mantener en buen estado la unidad asignada. El mantenimiento adecuado evita riesgos, retrasos y una operación segura.</p>
    </div>

    <section class="apply-section-textarea"> 
        <div class="left-section">
            <h2>Formulario de Reporte de Mantenimiento</h2>
            <div id="notification" class="notification"></div>
            <form id="apply">   
                <div class="field-group">
                    <label>Nombre Completo</label>
                    <input name="name" required placeholder="Ej: Juan Pérez">
                </div>
                <div class="field-group">
                    <label>Numero de Unidad o equipo de arrastre</label>
                    <input name="unidad" placeholder="Ej: 123">
                </div>
                <div class="field-group">
                    <label>Base original de Trabajo</label>
                    <input name="base" placeholder="Ej: Ciudad de México">
                </div>
                <div class="field-group">
                    <label>Ubicación actual de la unidad</label>
                    <input name="position" placeholder="Ej: Bodega Norte">
                </div>
                <div class="field-group">
                    <label>Tipo de Mantenimiento</label>
                    <select id="tipoMantenimiento" name="tipoMantenimiento" required>
                        <option value="" disabled selected>-- Selecciona una opción --</option>
                        <option value="Preventivo">Preventivo</option>
                        <option value="Correctivo">Correctivo</option>
                        <option value="Emergente">Emergente</option>
                    </select>
                </div>
                <div id="estadoUnidadDiv" style="display: none;">
                    <div class="field-group">
                        <label>Estado de la Unidad</label>
                        <select name="estadoUnidad">
                            <option value="" disabled selected>-- Selecciona una opción --</option>
                            <option value="La unidad puede operar">La unidad puede operar</option>
                            <option value="Operar con restricciones">Operar con restricciones</option>
                            <option value="No puede operar">No puede operar</option>
                        </select>
                    </div>
                </div>
                <div id="estadoEntregaDiv" style="display: none;">
                    <div class="field-group">
                        <label>Estado de Entrega de pedido</label>
                        <select name="estadoEntrega">
                            <option value="" disabled selected>-- Selecciona una opción --</option>
                            <option value="Estaba por entregar">Estaba por entregar</option>
                            <option value="Tenia entrega lista">Tenia entrega lista</option>
                        </select>
                    </div>
                </div>
                <div class="field-group">
                    <label>Descripción detallada de la falla o mantenimiento requerido</label>
                    <textarea name="comment" placeholder="Describe la falla o mantenimiento"></textarea>
                </div>
                <div class="button-container">
                    <button type="submit" class="button-submit">Enviar</button>
                </div>
            </form>
            <div id="msg" aria-live="polite"></div>
            <div id="msgPreventivo" class="mensaje-preventivo" style="display: none;">
                <p>¡Buen trabajo! Reportar a tiempo el mantenimiento preventivo ayuda a evitar fallas y cuida nuestras unidades.</p>
            </div>
        </div>
        <div class="right-section">
            <div class="tabs">
                <button class="tab active" data-period="Diaria">D</button>
                <button class="tab" data-period="Mensual">M</button>
                <button class="tab" data-period="Anual">A</button>
            </div>
            <h2>Tu actividad Diaria</h2>
            <div class="quadrants">
                <div class="quadrant">
                 <div class="quad-title">Reportes de mantenimiento</div><canvas id="reportes-chart"></canvas>
                </div>
                <div class="quadrant"><div class="quad-title">Entregas de pedido</div><canvas id="entregas-chart"></canvas></div>
                <div class="quadrant">Kilometros recorridos</div>
                <div class="quadrant">Unidad de Transporte</div>
            </div>
        </div>
    </section>

    <script>
        // Mostrar/Ocultar recuadro de estado de unidad y estado de entrega
        document.getElementById('tipoMantenimiento').addEventListener('change', function() {
            const estadoDiv = document.getElementById('estadoUnidadDiv');
            const entregaDiv = document.getElementById('estadoEntregaDiv');
            
            if (this.value === 'Emergente') {
                estadoDiv.style.display = 'block';
            } else {
                estadoDiv.style.display = 'none';
            }
            
            if (this.value === 'Correctivo' || this.value === 'Emergente') {
                entregaDiv.style.display = 'block';
            } else {
                entregaDiv.style.display = 'none';
            }
        });

        document.getElementById('apply').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const datos = Object.fromEntries(formData);
            
            fetch('/guardar-datos', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(datos)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const notif = document.getElementById('notification');
                    notif.textContent = 'El formulario se ha enviado a Mantenimiento con éxito';
                    notif.classList.add('show');
                    setTimeout(() => {
                        notif.innerHTML = '<div class="check-circle">✓</div>';
                    }, 2000);
                    this.reset();
                } else {
                    document.getElementById('msg').textContent = '✗ Error: ' + data.message;
                }
            })
            .catch(error => {
                document.getElementById('msg').textContent = '✗ Error al enviar los datos';
            });
        });
    </script>
    <script src="KPI.js"></script>
    <script src="tabs.js"></script>
</body>
</html>
