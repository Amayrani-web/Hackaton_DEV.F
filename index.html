<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>GRUPO SID by Traxi√≥n - Mantenimiento de Unidades</title>
    <link rel="stylesheet" href="styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Estilos r√°pidos para el chat */
        #chat-toggle { position: fixed; bottom: 20px; right: 20px; background: #444; color: white; border: none; border-radius: 50%; width: 60px; height: 60px; cursor: pointer; font-size: 24px; z-index: 1001; }
        .chat-window { position: fixed; bottom: 90px; right: 20px; width: 320px; height: 450px; background: white; border: 1px solid #ccc; border-radius: 12px; display: none; flex-direction: column; box-shadow: 0 5px 20px rgba(0,0,0,0.2); z-index: 1000; font-family: sans-serif; }
        .chat-header { background: #666; color: white; padding: 15px; border-radius: 12px 12px 0 0; font-weight: bold; }
        .chat-box { flex: 1; overflow-y: auto; padding: 15px; background: #f9f9f9; }
        .chat-input-area { display: flex; padding: 10px; gap: 5px; border-top: 1px solid #eee; }
        .chat-input-area input { flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 5px; }
        .chat-input-area button { background: #444; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; }
        .msg-user { background: #e3f2fd; padding: 8px; border-radius: 8px; margin-bottom: 10px; text-align: right; }
        .msg-ai { background: #eee; padding: 8px; border-radius: 8px; margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="imagen-centrada">
        <img src="https://traxion.global/hubfs/traxion-global-sitio-mar24/Nuevos%20Logos%20REDIMENSI%C3%93N/Logos%20TRAXION%20-%20No%20tilde/SVG-500x150_17-TRAXION%20ESP%20GRIS.svg" alt="Logo Traxi√≥n" width="250" height="75">
    </div>
    <div class="color-y-fondo">Cuidar nuestras unidades es parte de nuestro trabajo.</div>
    <div class="seccion-imagen-fondo">
        <p>Cada colaborador es responsable de reportar, revisar y mantener en buen estado la unidad asignada.</p>
    </div>

    <section class="apply-section-textarea"> 
        <form id="apply">
            <label>Fecha de Inspecci√≥n: <input type="date" name="fecha" required></label><br>  
            <label>Nombre Completo: <input name="name" required> </label><br>
            <label>Numero de Unidad o equipo de arrastre: <input name="unidad"></label><br>
            <label>Base original de Trabajo: <input name="base"></label><br>    
            <label>Ubicaci√≥n actual de la unidad.: <input name="position"></label><br>
            <p>Tipo de Mantenimiento:</p>
            <label><select id="tipoMantenimiento" name="tipoMantenimiento" required>
                <option value="">-- Selecciona una opci√≥n --</option>
                <option value="Preventivo">Preventivo</option>
                <option value="Correctivo">Correctivo</option>
                <option value="Emergente">Emergente</option>
            </select></label><br>
            <div id="estadoUnidadDiv" style="display: none;">
                <p>Estado de la Unidad:</p>
                <label><select name="estadoUnidad">
                    <option value="">-- Selecciona una opci√≥n --</option>
                    <option value="La unidad puede operar">La unidad puede operar</option>
                    <option value="Operar con restricciones">Operar con restricciones</option>
                    <option value="No puede operar">No puede operar</option>
                </select></label><br>
            </div>
            <div id="estadoEntregaDiv" style="display: none;">
                <p>Estado de Entrega:</p>
                <label><select name="estadoEntrega">
                    <option value="">-- Selecciona una opci√≥n --</option>
                    <option value="Estaba por entregar">Estaba por entregar</option>
                    <option value="Tenia entrega lista">Tenia entrega lista</option>
                </select></label><br>
            </div>
            <label>Subir Evidencia (Fotos/PDF): <input type="file" name="evidencia" id="evidencia" accept=".jpg, .png, .pdf" multiple> </label><br>
            <label>Descripci√≥n detallada de la falla:<br><textarea name="comment"></textarea></label><br>
            <button type="submit" class="button-submit">Enviar</button>
        </form>
        <div id="msg" aria-live="polite"></div>
    </section>

    <button id="chat-toggle" onclick="toggleChat()">üí¨</button>
    <div id="chat-container" class="chat-window">
        <div class="chat-header">Asistente Traxi√≥n (Prototipo)</div>
        <div id="chat-box" class="chat-box">
            <div class="msg-ai">Hola, soy el asistente t√©cnico. Escribe un c√≥digo SPN (ej. 1761) o una duda (ej. urea, llantas) para ayudarte.</div>
        </div>
        <div class="chat-input-area">
            <input type="text" id="user-input" placeholder="Escribe tu duda...">
            <button onclick="enviarMensaje()">Enviar</button>
        </div>
    </div>

    <script>
        // --- BASE DE CONOCIMIENTO (Sin Cites) ---
        const baseConocimiento = {
            especificaciones: {
                "urea": "Nivel de DEF (Urea): Mantener >25% para evitar cristalizaci√≥n.",
                "dpf": "Saturaci√≥n DPF (SPN 3251): Programar regeneraci√≥n si llega al 60%.",
                "bateria": "Estado de Bater√≠as (SPN 168): Si es <12.4V en reposo, cargar bater√≠as.",
                "direccion": "Direcci√≥n: M√°ximo 30¬∞ de juego en volante (Norma NOM-068).",
                "frenos": "Presi√≥n de Aire: Man√≥metro >90 PSI. No mover si la alarma sonora est√° activa.",
                "llantas": "Llantas: Dibujo > 3mm. Rotaci√≥n cada 10,000 km recomendada.",
                "aceite": "Lubricaci√≥n: No sobrepasar el nivel m√°ximo para no da√±ar los sellos.",
                "anticongelante": "Enfriamiento: Revisar mangueras por grietas o fugas."
            },
            codigosFalla: {
                "spn 1761": "SPN 1761: Nivel de DEF (Urea) bajo. Mantener >25%.",
                "spn 3251": "SPN 3251: Saturaci√≥n DPF. Programar regeneraci√≥n al 60%.",
                "spn 102": "SPN 102: Presi√≥n de Boost (Turbo). Reportar silbidos extra√±os de inmediato.",
                "spn 168": "SPN 168: Voltaje de Bater√≠as <12.4V. Cargar bater√≠as."
            }
        };

        // Visibilidad de campos
        document.getElementById('tipoMantenimiento').addEventListener('change', function() {
            document.getElementById('estadoUnidadDiv').style.display = (this.value === 'Emergente') ? 'block' : 'none';
            document.getElementById('estadoEntregaDiv').style.display = (this.value === 'Correctivo' || this.value === 'Emergente') ? 'block' : 'none';
        });

        // Chatbot L√≥gica Local
        const chatContainer = document.getElementById('chat-container');
        const chatBox = document.getElementById('chat-box');
        const userInput = document.getElementById('user-input');

        function toggleChat() {
            chatContainer.style.display = (chatContainer.style.display === 'none' || chatContainer.style.display === '') ? 'flex' : 'none';
        }

        function enviarMensaje() {
            const textoOriginal = userInput.value.trim();
            if (!textoOriginal) return;

            chatBox.innerHTML += `<div class="msg-user"><b>T√∫:</b> ${textoOriginal}</div>`;
            userInput.value = '';
            chatBox.scrollTop = chatBox.scrollHeight;

            const msg = textoOriginal.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            let respuestaIA = "Soy tu Asistente Traxi√≥n. ¬øNecesitas apoyo con alg√∫n componente o c√≥digo de falla?";

            // Buscar en c√≥digos SPN
            const codigoEncontrado = Object.keys(baseConocimiento.codigosFalla).find(c => msg.includes(c));
            if (codigoEncontrado) {
                respuestaIA = baseConocimiento.codigosFalla[codigoEncontrado];
            } else {
                // Buscar en especificaciones generales
                const specEncontrada = Object.keys(baseConocimiento.especificaciones).find(s => msg.includes(s));
                if (specEncontrada) respuestaIA = baseConocimiento.especificaciones[specEncontrada];
            }

            setTimeout(() => {
                chatBox.innerHTML += `<div class="msg-ai"><b>Asistente:</b> ${respuestaIA}</div>`;
                chatBox.scrollTop = chatBox.scrollHeight;
            }, 500);
        }

        userInput.addEventListener("keypress", (e) => { if (e.key === "Enter") enviarMensaje(); });

        // Manejo de formulario (Prototipo)
        document.getElementById('apply').addEventListener('submit', function(e) {
            e.preventDefault();
            document.getElementById('msg').textContent = '‚úì Inspecci√≥n registrada (Modo Prototipo Local)';
            this.reset();
        });
    </script>
</body>
</html>